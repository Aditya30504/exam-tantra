<!DOCTYPE html>
<html>
  <head>
    <title>Conduct Exam</title>
    <link rel="stylesheet" href="../public/conduct_exam.css" />
  </head>
  <body>
    <header>
      <nav id="instructions-bar">
        <label> Exam title : </label
        ><input type="text" id="exam-title" placeholder="Physics" />
        <label>Exam duration(in minutes) : </label
        ><input type="text" id="duration" placeholder="30" />
        <div></div>
        <label> Start time : </label
        ><input type="text" id="start" placeholder="HH:MM:SS" />
      </nav>
    </header>
    <main>
      <input type="text" placeholder="Insert a question" id="question-bar" />

      <div class="options-bar">
        <div class="option-name">A</div>
        <input type="text" placeholder="Insert option-1" class="options" />
      </div>

      <div class="options-bar">
        <div class="option-name">B</div>
        <input type="text" placeholder="Insert option-2" class="options" />
      </div>

      <div class="options-bar">
        <div class="option-name">C</div>
        <input type="text" placeholder="Insert option-3" class="options" />
      </div>

      <div class="options-bar">
        <div class="option-name">D</div>
        <input type="text" placeholder="Insert option-4" class="options" />
      </div>

      <input type="text" placeholder="Enter Correct Option" id="answer" />
    </main>
    <div id="footer">
      <button id="insert-btn" onclick="insertQues()">Insert</button>
      <button id="submit-btn" onclick="submitQues()">Submit</button>
    </div>
    <script type="text/javascript">
      var questions = [];
      var answers = [];
      function insertQues() {
        let question = document.getElementById("question-bar");
        let options = document.getElementsByClassName("options");
        let answer = document.getElementById("answer");
        if (question.value && answer.value) {
          let q = {
            name: question.value,
            option_1: options[0].value,
            option_2: options[1].value,
            option_3: options[2].value,
            option_4: options[3].value,
          };
          answers.push(answer.value);
          questions.push(q);
          console.log(questions[0]["name"]);
          question.value = "";
          options[0].value = "";
          options[1].value = "";
          options[2].value = "";
          options[3].value = "";
          answer.value = "";
        } else {
          alert(" :)  Question and answer can't be empty ");
        }
      }
      async function submitQues() {
        var date = new Date();
        var month = date.getMonth();
        var day = date.getDay();
        var year = date.getFullYear();
        let time = document.getElementById("start").value;
        let duration = document.getElementById("duration").value;
        let schedule_time = month + " " + day + ", " + year + " " + time;
        let title = document.getElementById("exam-title").value;
        console.log(duration + title + schedule_time);
        insertQues();
        if (duration && schedule_time && title) {
          // post question along with instructions
          const origin = document.location.origin;
          const token = localStorage.getItem("token");
          const response = await fetch(origin + "/api/conduct_exam", {
            method: "POST",
            headers: {
              "Content-Type": "application/json;charset=utf-8",
              Authorization: "Bearer" + " " + token,
            },
            body: JSON.stringify({
              correct_answer: answers,
              duration: duration,
              questions: questions,
              schedule_time: schedule_time,
              title: title,
            }),
          });
          if (response.ok) {
            let exam_code = await response.text();
            alert("Your exam_code is : " + exam_code);
          } else {
            let exam_code = await response.text();
            alert("Something went wrong\n" + exam_code);
          }
        } else {
          alert("  :) duration and starting time can't be empty ");
        }
      }
    </script>
  </body>
</html>
